<html>
<head>
    <meta name="description" content=" " />
    <title>Script Library: </title>
    <link rel="stylesheet" type="text/css" href="./default.css" />
</head>
<body class="">
    <h1>ScriptLibrary</h1>
    <h3>Name:
        <div>
            <table width='100%'>
                <tr>
                    <td width='50%' bgcolor='yellow'>ApprovalUtil_20091024_Emily_backup</td>
                    <td width='50%' bgcolor='yellow'>ApprovalUtil</td>
                </tr>
            </table>
        </div>
    </h3>
    <h3>Package: </h3>
    <h3>System? </h3>
    <table>
        <tbody>
            <tr>
                <th>Script:</th>
            </tr>
            <tr>
                <td>
                    <pre><div><table width='100%'><tr><td width='100%'  colpan='2'>/**</td></tr><tr><td width='100%'  colpan='2'>* This script contains various functions used in Approval Delegation Wizzard</td></tr><tr><td width='100%'  colpan='2'>* </td></tr><tr><td width='100%'  colpan='2'>* Hua Zhang</td></tr><tr><td width='100%'  colpan='2'>*/</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>var currentUser;</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>/**</td></tr><tr><td width='100%'  colpan='2'>* This function returns a query that is used by link record for lookup delegate</td></tr><tr><td width='100%'  colpan='2'>* This unfction will check to make sure the operator it retrieves has a valid profile</td></tr><tr><td width='100%'  colpan='2'>* for the module being delegated. It also verifies operator has approval rights in their </td></tr><tr><td width='100%'  colpan='2'>* profile for change and request. Capability words were also checked for chang and request</td></tr><tr><td width='100%'  colpan='2'>* module.</td></tr><tr><td width='100%'  colpan='2'>*/</td></tr><tr><td width='100%'  colpan='2'>function getFilteredQuery(module)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//first, process condition with delegate all</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var filteredQuery = "true";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;if(module =="all" || system.vars.$delegate_all)</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;if(module =="all" || ( ! module && system.vars.$delegate_all ) )</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(var i=0;i<system.vars.$avail_approval_modules_value.length();++i)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filteredQuery +=" and "+ getQuery(system.vars.$avail_approval_modules_value[i]);&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filteredQuery +=" and ("+ getQuery(system.vars.$avail_approval_modules_value[i]) + ")";&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filteredQuery = appendCapabilitySql(filteredQuery,"all")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var delegateModule = module;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (delegateModule == null || delegateModule == "") </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delegateModule = system.vars.$delegate_module;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filteredQuery =getQuery(delegateModule);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filteredQuery = appendCapabilitySql(filteredQuery,delegateModule);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//print("return  filteredQuery "+filteredQuery);</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return filteredQuery;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>//This is the query to retrieve valid profile query</td></tr><tr><td width='100%'  colpan='2'>function getQuery(moduleName)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var profileSql="view=true";&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;profileName="cm3profile";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if (moduleName=="Change") </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileName="cm3profile";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileName="secRights";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileSql="view=true and approvals=true";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileSql="area=\"Change\" and view=true";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if(moduleName=="Request") </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileName="ocmprofile";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileSql="view=true and approvals=true";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if(moduleName=="SVC") </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileName="smenv";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileSql="view=true";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if(moduleName=="Problem")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileName="rcenv";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileSql="view=true";&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;else if (false && moduleName=="Timeperiod") </td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileName="secRights";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileSql="area=\"Timeperiod\" and view=true";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileName="pmenv";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileSql="view=true";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;profileSql += " and "+addFolderQuery(moduleName);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;&nbsp;&nbsp;&nbsp;profile = new SCFile(profileName);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var rc = profile.doSelect(profileSql);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = new Array();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;while(rc == RC_SUCCESS)  </td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( moduleName == "Change"||moduleName == "Timeperiod" )</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var index = system.functions.index( "approvals", profile.settingId );</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( index > 0 )</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var valid = profile.settingValue[ index - 1 ];</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( valid == "true" )</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var aProfile=profileArray.push(profile.role)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var aProfile=profileArray.push(profile.name);</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var aProfile=profileArray.push(profile.name);</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rc = profile.getNext();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return buildSql(profileName,profileArray);</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>//make sure operator has the right profiles</td></tr><tr><td width='100%'  colpan='2'>function buildSql(profileName, profileArray)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var sql = "";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if( profileName=="cm3profile" || profileName=="secRights")</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql="secRole=\""+profileArray[0]+"\"";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for ( var i = 1, lng = profileArray.length; i < lng ; i ++ )</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql += " or secRole=\""+profileArray[i]+"\""</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;if( profileName=="cm3profile")</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return sql;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql="profile.change isin ";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if( profileName=="ocmprofile")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql="profile.request isin ";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if( profileName=="smenv")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql="profile.service isin ";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if( profileName=="rcenv")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql="profile.rootcause isin ";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if( profileName=="pmenv")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql="profile.incident isin ";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var cond = "{";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;for (var i=0; i<profileArray.length; i++)</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;for(i in profileArray)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;    if (profileArray.hasOwnProperty(i)) {</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond+="\""+profileArray[i]+"\"";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond+="\""+profileArray[i]+"\"";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i<profileArray.length-1)</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i<profileArray.length-1)</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cond+=",";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cond+=",";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;cond+="}";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;cond=sql+cond;</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return cond;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>//If folder is  enabled, we will also make sure to</td></tr><tr><td width='100%'  colpan='2'>// retrieve delegate if it has same filder access as </td></tr><tr><td width='100%'  colpan='2'>//the approver</td></tr><tr><td width='100%'  colpan='2'>function addFolderQuery(module)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//if folder is enabled, first find all folders the user has view access to</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var folderQuery = "true";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if (system.vars.$G_folderEntitlement) </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get current operator record</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (currentUser == null) {</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getCurrentUser();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var sql= "";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var tableName="cm3";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("addFolderQuery 111 "+module+" currentUser.profile_change "+currentUser.profile_change);</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(module=="Change")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = currentUser.profile_change;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var cond = "{";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(var i=0; i<profileArray.length();++i)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond+="\""+profileArray[i]+"\",";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond = cond.substring(0,cond.length-1);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond += "}";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql = "tablename=\"cm3\" and name isin "+cond;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName = "cm3";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if(module=="Timeperiod")</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = vars.$G_roles;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var cond = "{";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(var i=0; i<profileArray.length();++i)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond+="\""+profileArray[i]+"\",";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond = cond.substring(0,cond.length-1);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond += "}";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql = "tablename=\"timeperiodDefinition\" and name isin "+cond;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName = "timeperiodDefinition";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if(module=="Request")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = currentUser.profile_request;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var cond = "{";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(var i=0; i<profileArray.length();++i)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond+="\""+profileArray[i]+"\",";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i<profileArray.length-1)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond+=",";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond = cond.substring(0,cond.length-1);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond += "}";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql = "tablename=\"ocm\" and name isin "+cond;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName = "ocm";&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if(module=="SVC")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileName = currentUser.profile_service;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql = "tablename=\"incidents\" and name =\""+profileName+"\"";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName = "incidents";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if(module=="Incident")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileName = currentUser.profile_incident;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql = "tablename=\"pobsummary\" and name =\""+profileName+"\"";&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName = "pobsummary";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName = "probsummary";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileName = currentUser.profile_rootcause;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sql = "tablename=\"rootcause\" and name =\""+profileName+"\"";&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableName = "rootcause";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var folderRights = new SCFile("FolderRights");</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rc = folderRights.doSelect(sql);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//next, check for each FolderRights record to see if it has view rights</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("addFolderQuery after select folderRights "+folderRights);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var folderArray = new Array();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(rc == RC_SUCCESS)  </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (folderRights.view == true && isDuplicate(folderArray,folderRights.folder)!=true)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;folderArray.push(folderRights.folder);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rc = folderRights.getNext();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("addFolderQuery after while folderArray "+folderArray);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var aFolderQuery = "tablename=\""+tableName+"\" and view=true and ";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (folderArray.length !=0)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aFolderQuery += " folder isin {";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in folderArray)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;&nbsp;&nbsp;&nbsp;if (folderArray.hasOwnProperty(i)) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    </td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aFolderQuery += "\"" +folderArray[i]+"\"";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aFolderQuery += "\"" +folderArray[i]+"\"";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i<folderArray.length-1)</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i<folderArray.length-1)</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aFolderQuery+=",";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aFolderQuery+=",";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aFolderQuery += "}";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("addFolderQuery after for aFolderQuery "+aFolderQuery);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//next, find all profiles who has view rights to those folder</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var aRight = new SCFile("FolderRights");</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rc = aRight.doSelect(aFolderQuery);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("aRight select results is "+aRight);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var nodupFolderAray = new Array();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var hasdupFolderAray = new Array();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(rc == RC_SUCCESS)  </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("in while loop name is "+aRight.name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hasdupFolderAray.push(aRight.name);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!isDuplicate(nodupFolderAray,aRight.name))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nodupFolderAray.push(aRight.name);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rc = aRight.getNext();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("newFolderAray after newFolderAray="+newFolderAray);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var newFolderArray = isCorrectLength(nodupFolderAray,hasdupFolderAray,folderArray.length);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (newFolderArray.length !=0)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;folderQuery = " name isin {";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i in newFolderArray)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   if (newFolderArray.hasOwnProperty(i)) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;folderQuery += "\"" +newFolderArray[i]+"\"";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i<newFolderArray.length-1)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;folderQuery+=",";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;   }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;folderQuery += "}";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("addFolderQuery returns  "+folderQuery);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;} </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return folderQuery;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>//retrieve and cache current operator record</td></tr><tr><td width='100%'  colpan='2'>function getCurrentUser()</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;currentUser = new SCFile("operator");</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var sql = "name=\""+system.functions.operator()+"\"";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var rc = currentUser.doSelect(sql);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>function isDuplicate(array,element)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;for (i in array)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(array[i] == element) </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return false;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>function isCorrectLength(nodupFolderAray,hasdupFolderAray,length)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//print("isCorrectLength nodupFolderAray="+nodupFolderAray+" hasdupFolderAray is "+hasdupFolderAray);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var folderArray = new Array();</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var match = 0;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;for (i in nodupFolderAray)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;    if (nodupFolderAray.hasOwnProperty(i)) {</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("isCorrectLength nodupFolderAray[i]="+nodupFolderAray[i]);</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in hasdupFolderAray)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("isCorrectLength nodupFolderAray[i]="+nodupFolderAray[i]);</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    if (hasdupFolderAray.hasOwnProperty(j)) {</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j in hasdupFolderAray)</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("isCorrectLength hasdupFolderAray[j]="+hasdupFolderAray[j]+" nodupFolderAray[i] "+nodupFolderAray[i]);</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (hasdupFolderAray[j] == nodupFolderAray[i])</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("isCorrectLength hasdupFolderAray[j]="+hasdupFolderAray[j]+" nodupFolderAray[i] "+nodupFolderAray[i]);</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++match;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (hasdupFolderAray[j] == nodupFolderAray[i])</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (match == length) </td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++match;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (match == length) </td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("matched, hasdupFolderAray[i]="+nodupFolderAray[i]);</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;folderArray.push(nodupFolderAray[i]);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print("matched, hasdupFolderAray[i]="+nodupFolderAray[i]);</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match = 0;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;folderArray.push(nodupFolderAray[i]);&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match = 0;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return folderArray;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>// append capability words for change and request</td></tr><tr><td width='100%'  colpan='2'>function appendCapabilitySql(approvalQry,module)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if(module == "SVC")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return approvalQry;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if (module == "Change")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; approvalQry += " and (cap.exec isin {\"SysAdmin\",\"ChmAdmin\",\"change request\",\"change task\"})";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //approvalQry += " and (cap.exec isin {\"SysAdmin\",\"ChmAdmin\",\"change request\",\"change task\"})";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if (module == "Request")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;approvalQry += " and (cap.exec isin {\"SysAdmin\",\"OCMAdmin\",\"OCMQ\"})";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;  </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if (module == "all")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//approvalQry += " and (cap.exec isin {\"SysAdmin\",\"OCMAdmin\",\"OCMQ\"} and cap.exec isin {\"SysAdmin\",\"ChmAdmin\",\"change request\",\"change task\"})";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;//approvalQry += " and (cap.exec isin {\"SysAdmin\",\"OCMAdmin\",\"OCMQ\"} and (index(\"SysAdmin\",str(cap.exec))>0 or index(\"ChmAdmin\", str(cap.exec))>0 or index(\"change request\", str(cap.exec))>0 or index(\"change task\", str(cap.exec))>0)) ";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;approvalQry += " and (cap.exec isin {\"SysAdmin\",\"OCMAdmin\",\"OCMQ\"} and cap.exec isin {\"SysAdmin\",\"ChmAdmin\",\"change request\",\"change task\"})";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;approvalQry += " and (cap.exec isin {\"SysAdmin\",\"OCMAdmin\",\"OCMQ\"})";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return approvalQry;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>//check to see whether a approver can do delegate all approvals</td></tr><tr><td width='100%'  colpan='2'>//approver can do delegate all only if can delegate flag is set</td></tr><tr><td width='100%'  colpan='2'>//to true for all his approval module</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>function canDelegateAll()</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if (system.vars.$G_sm_environment.approve_delegate != true)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if (checkProfileForDelegate("change")==false)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if (checkProfileForDelegate("request")==false)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (false && checkProfileForDelegate("Timeperiod")==false)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return true;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>function checkProfileForDelegate(module)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//retrieve user profile</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;getCurrentUser();</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (false && module=="Timeperiod")</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;   if (lib.security.getToken("Timeperiod","approve.delegate")=="true"){</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;   }</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;   return false;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;//get change profile</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if ( module == "change" )</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var crc = lib.security.getToken( "Change", "approve.delegate");</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( crc == "true" )</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;//get change profile&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;var profileNames = system.functions.str(system.functions.denull(currentUser.profile_change));</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;if (module == "request")</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileNames = system.functions.str(system.functions.denull(currentUser.profile_request));</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;var profileSql = "name isin "+profileNames;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;var profiles = new SCFile("cm3profile");</td><td  width='50%' bgcolor='yellow'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if (module == "request")</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileNames = system.functions.str(system.functions.denull(currentUser.profile_request));</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileSql = "name isin "+profileNames;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profiles = new SCFile("ocmprofile");</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profiles = new SCFile("ocmprofile");</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;var rc = profiles.doSelect(profileSql);</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rc = profiles.doSelect(profileSql);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(rc == RC_SUCCESS)  </td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;while(rc == RC_SUCCESS)  </td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (profiles.approve_delegate == true)</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (profiles.approve_delegate == true)</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = profiles.getNext();&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = profiles.getNext();&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return false;</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>//check to see if this is a delegate approval, if it is, return delegate, else return empty string</td></tr><tr><td width='100%'  colpan='2'>function checkDelegate(approvalQry,module)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;return checkDelegates(approvalQry,module, null);</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>function checkDelegates(approvalQry,module,delegateGrp)</td></tr><tr><td width='100%'  colpan='2'>{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (approvalQry == null)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//retrieve approval</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var approval = new SCFile("Approval");</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var rc = approval.doSelect(approvalQry);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var pendingGroups = approval.current_pending_groups;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(system.functions.operator(),pendingGroups))</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//retrieve user profile</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;getCurrentUser();</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var moduleName = "Change";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;if(module.indexOf("cm3")!=-1)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var myGroups = new SCFile("myGroups");</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mySql = "name=\""+system.functions.operator()+"\"";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( myGroups.doSelect( mySql ) == RC_SUCCESS )</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = myGroups.approver_of;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = currentUser.profile_change;&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i in profileArray)</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i in profileArray)</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(pendingGroups,profileArray[i]))</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(pendingGroups,profileArray[i]))</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "";</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%' colspan="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if(module.indexOf("ocm")!=-1)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = currentUser.profile_request;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(i in profileArray)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(pendingGroups,profileArray[i]))</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleName = "Request";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if(module=="incidents")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileName = currentUser.profile_service;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleName = "SVC";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(pendingGroups,profileName))</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else if(module=="probsummary")</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileName = currentUser.profile_incident;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleName = "Incident";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(pendingGroups, profileName))</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;else if(false && module=="timeperiodDefinition")</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileArray = vars.$lo_pm_assignments;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var i=0;i<profileArray.length;i++)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(pendingGroups, profileArray[i]))</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var profileName = currentUser.profile_rootcause;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;moduleName = "Problem";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(isDuplicate(pendingGroups,profileName))</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;return ""</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//now, look for who it is delegate from</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var delegate = new SCFile("ApprovalDelegation");</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;var date = system.functions.str(system.functions.date(system.functions.tod()));</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;var date = system.functions.str(system.functions.tod());</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;var delegateSql ="";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (delegateGrp == null || delegateGrp =="" ) {</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;delegateSql = "Enable=true and Delegate=\""+system.functions.operator()+"\" and DateFrom <='"+date+"' and DateTo >='"+date+"'"</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}else { </td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delegateSql = "Enable=true and Delegate=\""+system.functions.operator()+"\" and DateFrom <='"+date+"' and DateTo >='"+date+"'   and AppGroup=\"" + delegateGrp + "\""</td></tr><tr><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;var delegateSql = "Enable=true and Delegate=\""+system.functions.operator()+"\" and DateFrom <='"+date+"' and DateTo >='"+date+"'"</td><td  width='50%' bgcolor='yellow'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//print("delegateSql="+delegateSql);</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;var rc = delegate.doSelect(delegateSql);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;//print("after query rc "+rc+" delegate="+delegate);</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;while(rc == RC_SUCCESS)  </td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (delegate.AppModule == "all" || delegate.AppModule == moduleName)</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return delegate.Approver;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = delegate.getNext();&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td width='100%'  colpan='2'>&nbsp;&nbsp;&nbsp;&nbsp;return "";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>//Get an array of modules which the current user has the permission to delegate approval</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>//The result is for actual values</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>function getCanDelegateModulesValue(){</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;var modules = new Array();</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (system.vars.$G_sm_environment.approve_delegate == true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push("SVC");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (checkProfileForDelegate("change")==true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push("Change");&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (checkProfileForDelegate("request")==true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push("Request");</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (false && checkProfileForDelegate("Timeperiod")==true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push("Timeperiod");&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;return modules;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>//Get an array of modules which the current user has the permission to delegate approval</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>//The result is for diaplay values</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>function getCanDelegateModules(){</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;var modules = new Array();</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (system.vars.$G_sm_environment.approve_delegate == true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push(system.functions.scmsg("SVC", "approval"));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (checkProfileForDelegate("change")==true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push(system.functions.scmsg("Change", "approval"));</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (checkProfileForDelegate("request")==true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push(system.functions.scmsg("Request", "approval"));</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if (false && checkProfileForDelegate("Timeperiod")==true)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modules.push(system.functions.scmsg("Timeperiod", "approval"));</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;return modules;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>// verify add delegate.</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>function verifyDelegate()</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if(vars.$Delegate_full_name != null)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var find = false;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var firstDelegate = null;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var qry = system.library.ApprovalUtil.getFilteredQuery("");</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qry += " and full.name=\""+vars.$Delegate_full_name+"\"";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qry += " and company isin $G.MS.company.list";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rcd = new SCFile("MSoperatorcontacts");</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rs = rcd.doSelect(qry);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rs != RC_SUCCESS)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vars.$Delegate = null;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;firstDelegate = rcd.name;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (vars.$Delegate!=null)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(rs == RC_SUCCESS)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(vars.$Delegate == rcd.name)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find = true;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs = rcd.getNext();</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!find)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vars.$Delegate = firstDelegate;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vars.$Delegate = null;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td width='100%'  colpan='2'>}</td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td width='100%'  colpan='2'></td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>// verify edit delegate.</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>function verifyEditDelegate()</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;if(vars.$adelegate_delegate_full_name != null)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var find = false;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var firstDelegate = null;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var qry = system.library.ApprovalUtil.getFilteredQuery(vars.$adelegate_appmodule);</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qry += " and full.name=\""+vars.$adelegate_delegate_full_name+"\"";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qry += " and company isin $G.MS.company.list";</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rcd = new SCFile("MSoperatorcontacts");</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rs = rcd.doSelect(qry);&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rs != RC_SUCCESS)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vars.$adelegate_delegate = null;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;firstDelegate = rcd.name;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (vars.$adelegate_delegate!=null)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(rs == RC_SUCCESS)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(vars.$adelegate_delegate == rcd.name)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find = true;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rs = rcd.getNext();</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!find)</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vars.$adelegate_delegate = firstDelegate;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;else</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vars.$adelegate_delegate = null;</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr><tr><td  width='50%' bgcolor='green' colpan='2'>&nbsp;</td><td  width='50%' bgcolor='green'>}</td></tr></table></div></pre>
                </td>
            </tr>
        </tbody>
    </table>
    <p />
    <table class="sysmod">
        <tbody>
            <tr>
                <th>SysModUser</th>
                <td>
                    <div>
                        <table width='100%'>
                            <tr>
                                <td width='50%' bgcolor='yellow'>ASIAPACIFIC_SUNM</td>
                                <td width='50%' bgcolor='yellow'>ASIAPACIFIC_LIUYAN</td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <th>SysModTime</th>
                <td>
                    <div>
                        <table width='100%'>
                            <tr>
                                <td width='50%' bgcolor='yellow'>24/10/2009 15:20:07</td>
                                <td width='50%' bgcolor='yellow'>05/02/2015 14:09:47</td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <th>SysModCount</th>
                <td>
                    <div>
                        <table width='100%'>
                            <tr>
                                <td width='50%' bgcolor='yellow'>10</td>
                                <td width='50%' bgcolor='yellow'>3</td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>
